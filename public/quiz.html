<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/quize.css">
  <link rel="img" href="./assets/img/logo.png">

  <title>Quiz</title>
</head>

<body onload="buscarLadoForca()">
  <div class="janela">
    <div class="header-left" id="headerLeft">
      <h1 id="tituloPagina">Star Legends</h1>

      <div class="hello">
        <h3 id="boasVindas">Olá, <span id="b_usuario">usuário</span>!</h3>
      </div>

      <div class="btn-nav-white" id="minigame">
        <a href="./dashboard/minigame.html">
        <h3>Minigame</h3>
        </a>
      </div>

      <div class="btn-nav" id="btnNav">
        <a href="./dashboard/dashboard.html">
          <h3>Gráficos</h3>
        </a>
      </div>

      <div class="btn-nav-white" id="btnNavWhite">
          <h3>Quiz</h3>
      </div>

      <div class="btn-logout" onclick="sair()" id="btnLogout">
        <h3>Sair</h3>
      </div>

    </div>

  </div>

  <div class="quiz">
    <div class="container" id="container1">
      <h1>Descubra de qual lado da força está!</h1>
      <div class="pergunta">
        <label for="pergunta" id="spanQuestaoExibida"></label>
      </div>
      <div class="opcoes">
        <div class="opcao" onclick="selecionar(this)">
          <input type="radio" name="respostas" id="primeiraOpcao">
          <label for="primeiraOpcao" id="labelOpcaoUm" class="opcaoLabel"></label>
        </div>
        <div class="opcao" onclick="selecionar(this)">
          <input type="radio" name="respostas" id="segundaOpcao">
          <label for="segundaOpcao" id="labelOpcaoDois" class="opcaoLabel"></label>
        </div>
        <div class="opcao" onclick="selecionar(this)">
          <input type="radio" name="respostas" id="terceiraOpcao">
          <label for="terceiraOpcao" id="labelOpcaoTres" class="opcaoLabel"></label>
        </div>
        <div class="opcao" onclick="selecionar(this)">
          <input type="radio" name="respostas" id="quartaOpcao">
          <label for="quartaOpcao" id="labelOpcaoQuatro" class="opcaoLabel"></label>
        </div>
      </div>
      <button onclick="avancar()">Avançar</button>
    </div>
    <div id="container2" class="container" style="display: none;">

      <div id="div_resultadoruim" style="display: none;" class="resultadoFinal">
        <h1>Você trilha o caminho do poder… </h1>
        <p>Você é um Sith, sua mente é estratégica, rápida e direta.
          Você não desperdiça energia com o que não importa.
          Sua postura é prática, intensa e, às vezes, dominadora… mas sempre eficiente.

          O poder corre forte em você.</p>
        <!-- <button onclick="voltar()">Voltar para dash</button> -->
      </div>
      <div id="div_resultadobom" style="display: none;" class="resultadoFinal">
        <h1>Você segue o caminho da Força…</h1>
        <p>Você é um Jedi, sua forma de agir revela equilíbrio, empatia e clareza.
          Você pensa nas pessoas, mas não se apega. Age com firmeza, sem perder a calma.
          Pode não perceber, mas suas escolhas mostram que você constrói — não destrói.
          A Força está com você.</p>
      </div>

    </div>
  </div>
</body>

</html>

<script>
  b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
  let idUsuario = sessionStorage.ID_USUARIO;

  var listaDeQuestoes = [

    {
      pergunta: "Você vê alguém sobrecarregado. O que faz?",
      alternativaA: "Ajudo, mesmo atrasando meu trabalho.",
      alternativaB: "Sigo meu caminho, mas fico pensando depois.",
      alternativaC: "Pergunto se posso ajudar sem me comprometer.",
      alternativaD: "Só ajudo se isso também resolver algo meu.",
      alternativaCorreta: "Han Solo"
    },

    {
      pergunta: "Em uma discussão, alguém fala algo que te irrita. Como reage?",
      alternativaA: "Mantenho a calma",
      alternativaB: "Devolvo a provocação, mas de forma controlada.",
      alternativaC: "Prefiro não responder, não quero alimentar briga.",
      alternativaD: "Uso o que foi dito a meu favor.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Precisa decidir algo importante rápido. Você:",
      alternativaA: "Pensa nas consequências para todos.",
      alternativaB: "Escolhe o caminho mais seguro.",
      alternativaC: "Analisa só o essencial e decide.",
      alternativaD: "Escolhe o que te dá mais vantagem.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Recebe uma crítica inesperada. Sua reação:",
      alternativaA: "Tento entender o motivo.",
      alternativaB: "Aceito, mas fico pensando nisso depois.",
      alternativaC: "Vejo se faz sentido e sigo.",
      alternativaD: "Guardo a informação para usar se precisar.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Alguém toma uma decisão que te afeta sem te consultar. Você:",
      alternativaA: "Conversa para alinhar melhor.",
      alternativaB: "Aceita, mas com frustração.",
      alternativaC: "Entende antes de reagir.",
      alternativaD: "Reavalio a relação e minhas prioridades.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: " O projeto em grupo está bagunçado. Você:",
      alternativaA: "Organiza o grupo para avançar.",
      alternativaB: "Foca só no seu trabalho.",
      alternativaC: "Sugere caminhos, mas deixa decidirem.",
      alternativaD: "Assume a liderança.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Alguém está progredindo mais rápido que você. Sua atitude:",
      alternativaA: "Sigo meu ritmo e aprendo com ela.",
      alternativaB: "Me esforço mais, mesmo com pressão.",
      alternativaC: "Ajusto meus métodos para evoluir melhor.",
      alternativaD: "Transformo em um desafio pessoal.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Aparece uma oportunidade inesperada. Você:",
      alternativaA: "Avalia se faz sentido para todos.",
      alternativaB: "Agarra antes que alguém pegue.",
      alternativaC: "Só entro se valer meu tempo.",
      alternativaD: "Aproveito sem pensar muito.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Um amigo pede ajuda que vai te tomar tempo. Você:",
      alternativaA: "Ajudo e reorganizo meu dia.",
      alternativaB: "Ajudo, mas aviso do pouco tempo.",
      alternativaC: "Ofereço só o que posso sem me prejudicar.",
      alternativaD: "Ajudo se isso fortalecer a relação.",
      alternativaCorreta: "alternativaD"
    },

    {
      pergunta: "Sob pressão, você tende a:",
      alternativaA: "Me acalmar e focar no essencial.",
      alternativaB: "Resolver o mais urgente primeiro.",
      alternativaC: "Agir de forma estratégica.",
      alternativaD: "Cortar o que atrapalha e ir direto ao ponto.",
      alternativaCorreta: "alternativaD"
    }

  ]

  preencherHTMLcomQuestaoAtual(0);

  var pontuacao = 0;
  var numeroDaQuestaoAtual = 0;
  var quantidadeDeQuestoes = listaDeQuestoes.length;
  var lado = 0


  function selecionar(divOpcao) {
    var anterior = document.querySelector(".selecionada");
    if (anterior) {
      anterior.classList.remove("selecionada");
    }

    divOpcao.classList.add("selecionada");

    var radio = divOpcao.querySelector("input");
    radio.checked = true;
  }


  function avancar() {

    var selecionado = ''
    var opcoes = document.getElementsByName("respostas");
    var hasChecked = false

    for (var i = 0; i < opcoes.length; i++) {
      if (opcoes[i].checked) {
        hasChecked = true
        selecionado = i;
        break
      }

    }

    if (!hasChecked) {
      alert("Não há alternativas escolhidas. Escolha uma opção.")
      return
    }

    if (selecionado == 0) {
      pontuacao += 3;
    } else if (selecionado == 1) {
      pontuacao += 1;
    } else if (selecionado == 2) {
      pontuacao -= 1;
    } else if (selecionado == 3) {
      pontuacao -= 3;
    }

    for (var i = 0; i < opcoes.length; i++) {
      opcoes[i].checked = false;
    }
    numeroDaQuestaoAtual++;

    if (numeroDaQuestaoAtual < quantidadeDeQuestoes) {
      preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
      limparCoresBackgroundOpcoes();
      return;
    } else {

      if (pontuacao <= 0) {
        container1.style.display = 'none'
        container2.style.display = 'flex'
        div_resultadoruim.style.display = 'flex'
        lado = 1

      } else {
        container1.style.display = 'none'
        container2.style.display = 'flex'
        div_resultadobom.style.display = 'flex'
        lado = 0
      }

      fetch("/quiz/registrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          idUsuarioServer: idUsuario,
          ladoServer: lado

        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {
            // cardErro.style.display = "block";

            alert("Quiz finalizado1.");

            setTimeout(() => {
              window.location = "./dashboard/dashboard.html";
            },10000);

          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });

      return false;
    }
  }



  function preencherHTMLcomQuestaoAtual(index) {
    const questaoAtual = listaDeQuestoes[index];

    document.getElementById("spanQuestaoExibida").innerHTML = questaoAtual.pergunta;
    document.getElementById("labelOpcaoUm").innerHTML = questaoAtual.alternativaA;
    document.getElementById("labelOpcaoDois").innerHTML = questaoAtual.alternativaB;
    document.getElementById("labelOpcaoTres").innerHTML = questaoAtual.alternativaC;
    document.getElementById("labelOpcaoQuatro").innerHTML = questaoAtual.alternativaD;
  }

  function limparCoresBackgroundOpcoes() {
    var opcoes = document.getElementsByClassName("opcao");

    for (var i = 0; i < opcoes.length; i++) {
      opcoes[i].classList.remove("selecionada");
    }

    var radios = document.getElementsByName("respostas");

    for (var i = 0; i < radios.length; i++) {
      radios[i].checked = false;
    }
  }

  function sari() {
    window.location.href = 'index.html'
  }

  function voltar() {
    window.location.href = './dashboard/dashboard.html'
  }


  function buscarLadoForca() {

    fetch(`/resultadoQuiz/resultado/${idUsuario}`, { cache: 'no-store' }).then(function (response) {

      if (response.ok) {
        response.json().then(function (resposta) {
          console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
          console.log('chegou aqui')

          var lado = resposta[0].lado_forca;

          if (lado == 1) {

            tituloPagina.style.color = '#c21414';
            boasVindas.style.color = '#9f1111';
            b_usuario.style.color = '#9f1111';
            minigame.style.borderColor = '#b91e1e';
            btnNav.style.backgroundColor = '#ad1717';
            headerLeft.style.borderColor = '#b61111';
            btnNavWhite.style.backgroundColor = '#ad1717';
            btnLogout.style.backgroundColor = "#b01313";




          }
          else if (lado == 0) {

            tituloPagina.style.color = '#0c9b00';
            boasVindas.style.color = '#0a6203';
            b_usuario.style.color = '#0a6203';
            minigame.style.borderColor = '#15b807';
            btnNav.style.backgroundColor = '#15b807';
            headerLeft.style.borderColor = '#15b807';
            btnNavWhite.style.borderColor = '#15b807';
            btnLogout.style.backgroundColor = "#15b807";



          }
          else {
            tituloPagina.style.color = '#0c58d8';
            boasVindas.style.color = '#0c3a86';
            b_usuario.style.color = '#0c3a86';
            minigame.style.borderColor = '#0346b8';
            btnNav.style.backgroundColor = '#0346b8';
            headerLeft.style.borderColor = '#0346b8';
            btnNavWhite.style.borderColor = '#0346b8';
            btnLogout.style.backgroundColor = "#0346b8";



          }

        });
      } else {
        console.error('Nenhum dado encontrado ou erro na API cor da dash');
      }
    })
      .catch(function (error) {
        console.error(`Erro na obtenção dos dados p/ KPI: ${error.message}`);
      });
  }
</script>